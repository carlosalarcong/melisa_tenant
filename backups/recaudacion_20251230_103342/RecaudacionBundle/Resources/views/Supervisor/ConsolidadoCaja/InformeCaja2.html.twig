{% spaceless %}
    {% set cajaExiste = 0 %}
    {% set cajagExiste = 0 %}
    {% for c in cajac %}
        {% set cajaExiste = cajaExiste + 1 %}
    {% endfor %}
    {% for c in cajaAnul %}
        {% set cajaExiste = cajaExiste + 1 %}
    {% endfor %}
    {% for c in caja %}
        {% set cajaExiste = cajaExiste + 1 %}
    {% endfor %}
    {% for c in cajag %}
        {% set cajagExiste = cajagExiste + 1 %}
    {% endfor %}
    {% for c in cajaAnulg %}
        {% set cajagExiste = cajagExiste + 1 %}
    {% endfor %}
    {% set cajaExisteAnul = 0 %}
    {% set cajagExisteAnul = 0 %}
    {% for c in cajaAnul %}
        {% set cajaExisteAnul = cajaExisteAnul + 1 %}
    {% endfor %}
    {% for c in cajaAnulg %}
        {% set cajagExisteAnul = cajagExisteAnul + 1 %}
    {% endfor %}
    {# MEDIOS PAGO VARS #}
    {% set sumaTotal = 0 %}
    {% set sumaBonificacion = 0 %}
    {% set sumaSeguro = 0 %}
    {% set sumaCopago = 0 %}
    {% set sumaEfectivo = 0 %}
    {% set sumaCheque = 0 %}
    {% set sumaChequeD = 0 %}
    {% set sumaChequeF = 0 %}
    {% set sumaTCredito = 0 %}
    {% set sumaTDebito = 0 %}
    {% set sumaGratuidad = 0 %}
    {% set sumaDiferencia = 0 %}
    {# ARANTIA VARS #}
    {% set sumaTotalG = 0 %}
    {% set sumaGarantia = 0 %}
    {% set sumaGarantiaL = 0 %}
    {% set sumaGarantiaI = 0 %}
    <style>
        body .modal {
            width: 98%;
            left: 1%;
            height: 90%;
            margin-right: auto;
            margin-left: 0%;
        }

        body .modal-body {
            padding: 1px;
            max-height: 92%;
            height: 92%;
        }

        body .modal.fade.in {
            top: 5%;
            bottom: 5%;
        }
    </style>


    <div class="table-header header-color-blue " style="text-align:left;">
        <span class="white"><b>INFORME DE CAJA:</b></span>
    </div>
    <div id="detallePagosCajeros">
        <div class="table-header-grey" style="text-align:left;">
            <i class="icon-dollar text-left space"> </i> Pagos
        </div>
        <table width="100%" border="0" cellspacing="0" cellpadding="0"
               class="table table-bordered table-condensed  grey zoom-pagos">
            <tr>
                <th colspan="13" width="47%" style=" background-color: cornsilk; font-size: larger ">
                    Pagos - SUCURSAL: {{ sucursal }}
                </th>
                <th colspan="11" width="47%" style=" background-color: azure; font-size: larger  ">
                    Detalle copagos y particulares:
                </th>
                <th width="6%"></th>
            </tr>
            <tr style=" background-color: #f5f5f5">
                <th> Cajero</th>
                <th> Pago cuenta</th>
                <th> ID atención</th>
                <th> Paciente</th>
                <th> Tipo de identificación</th>
                <th> Identificación</th>
                <th> Sexo</th>
                <th> Nombre sub empresa</th>
                <th> RUT sub empresa</th>
                <th> Nombre medico</th>
                <th> Especialidad</th>
                <th> Fecha reserva hora</th>
                <th> Fecha apertura caja</th>
                <th> Fecha detalle pago</th>
                <th> Boleta</th>
                <th> Sistema de salud</th>
                <th> Seguro</th>
                <th> Convenio de pago</th>
                <th> Total cuenta</th>
                <th> Forma de pago</th>
                <th> Numero documento</th>
                <th> Copago</th>

                <th> Tipo Documento</th>
                <th> Cuenta Contable</th>
                <th> Tipo Tarjeta</th>
                <th> Nombre Tarjeta</th>
                <th> Últimos 4 Dígitos</th>

                <th> Total descuento</th>
                <th> Total cuenta con descuento</th>
                <th> Monto pago cuenta</th>
            </tr>
            <tbody>
            {% for c in cajac %}
                <tr>
                    <td>{{ c.nombreUsuario|default('PAGO WEB')  }} {{ c.paternoUsuario }}</td>
                    <td>{{ c.idPagoCuenta }} </td>
                    <td>{{ c.idReservaAtencion|default('-') }} </td>
                    <td>{{ c.nombre }} {{ c.apellidoP }} {{ c.apellidoM }} </td>
                    <td>{{ c.tipoIdentificacion }} </td>
                    <td>{{ c.identificacion }} </td>
                    <td>{{ c.sexo }} </td>
                    <td>{{ c.nombreSubEmpresa }} </td>
                    <td>{{ c.rutsubemp }}-{{ c.dvsubemp }} </td>
                    <td>{{ c.nombreMedico|default('-') }} {{ c.apellidoPaternoMedico }} {{ c.apellidoMaternoMedico }} </td>
                    <td>{{ c.nombreEspecialidadMedica|default('-') }} </td>
                    {% if c.horarioInicio is null  %}
                        <td> - </td>
                        {% else %}
                            <td>{{ c.horarioInicio|date("d/m/Y H:i") }} - {{ c.horarioCierre|date("H:i") }}</td>
                    {% endif %}
                    <td>{{ c.fechaAperturaC|date("d/m/Y") }}</td>
                    <td>{{ c.datePagoCuenta|date("d/m/Y") }} </td>
                    <td>{{ c.boleta|default('-') }} </td>
                    <td>{{ c.financiador }} </td>
                    <td>{{ c.seguro|default('-') }} </td>
                    <td>{{ c.convenio|default('-') }} </td>
                    <td>{{ obtenerMonto(c.monto) }} </td>
                    <td>{{ c.formapago|default('-') }} </td>
                    <td>
                        {% if c.numeroDocumentoGeneral is not null and c.numeroDocumentoGeneral != 0 %}
                            {{ c.numeroDocumentoGeneral }}
                        {% elseif c.numeroVoucher is not null %}
                            {{ c.numeroVoucher }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ obtenerMonto(c.copago) }} </td>

                    <td>{{ c.tipoDocumento |default('-') }} </td>
                    <td>{{ c.cuentaContable |default('-') }} </td>
                    <td>{% if c.tipotarjeta == 'CR' %}
                            Tarjeta de Crédito
                        {% elseif c.tipotarjeta == 'DB' %}
                            Tarjeta de Débito
                        {% else %}
                            {{ c.tipotarjeta |default('-') }}
                        {% endif %}
                    </td>
                    <td>{{ c.tarjetaCreditoNombre |default('-') }} </td>
                    <td>{{ c.ultimos4Numeros |default('-') }} </td>

                    <td>{{ obtenerMonto(c.descuento) }} </td>
                    <td>{{ obtenerMonto(c.totalDescuento) }} </td>
                    <td>{% if c.idTipoFormaPago == 3 or c.idTipoFormaPago == 5 or c.idTipoFormaPago == 11 %}
                            {{ obtenerMonto(c.bonificacion)  }}
                        {% else %}
                            {{ obtenerMonto(c.montoPagoCuenta) }}
                        {% endif %}</td>
                </tr>
            {% endfor %}
            {% for c in cajaAnul %}
                <tr style=" background-color: rgb(238, 169, 169);">
                    <td>
                        {{ c.nombreUsuario }} {{ c.paternoUsuario }}
                    </td>
                    <td>
                        {{ c.idPagoCuenta }}
                    </td>
                    <td>
                        {{ c.idReservaAtencion|default('-') }}
                    </td>
                    <td>
                        {{ c.nombre }} {{ c.apellidoP }} {{ c.apellidoM }}
                    </td>
                    <td>
                        {{ c.tipoIdentificacion }}
                    </td>
                    <td>
                        {{ c.identificacion }}
                    </td>
                    <td>
                        {{ c.sexo }}
                    </td>
                    <td>
                        {{ c.nombreSubEmpresa }}
                    </td>
                    <td>
                        {{ c.rutsubemp }}-{{ c.dvsubemp }}
                    </td>
                    <td>
                        {{ c.nombreMedico }} {{ c.apellidoPaternoMedico }} {{ c.apellidoMaternoMedico }}
                    </td>
                    <td>
                        {{ c.nombreEspecialidadMedica|default('-') }}
                    </td>
                    <td>
                        {{ c.horarioInicio|date("d/m/Y H:i") }} - {{ c.horarioCierre|date("H:i") }}
                    </td>
                    <td>
                        {{ c.fechaAperturaC|date("d/m/Y") }}
                    </td>
                    <td>
                        {{ c.datePagoCuenta|date("d/m/Y") }}
                    </td>
                    <td>-</td>
                    <td>{% if c.convenio %} {{ c.convenio }}{% else %}{{ c.financiador }}{% endif %}</td>
                    </td>
                    <td>-</td>
                    <td>-</td>
                    <td>
                        <div>
                            {{ obtenerMonto(c.monto) }}
                        </div>
                    </td>
                    <td>
                        {% for fp in formaPago %}
                            {% if c.idPaciente == fp.idPaciente and c.idPagoCuenta == fp.idPagoCuenta %}
                                {% if fp.nombreForma %}
                                    {{ fp.nombreForma }}
                                    <div class="clearfix"></div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </td>

                    <td colspan="10">
                        <div style="text-align: center; font-weight: bolder  ">
                            <b><em>PAGO ANULADO</em></b>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <br>


        <table align="center" width="100%" class="table table-striped table-condensed table-bordered">
            {# TODOS LOS MEDIOS DE PAGO #}
            {# ciclo de medios de pago #}

    </div>
{% endspaceless %}
<link rel="stylesheet" href="{{ asset('bundles/hermes/acev12/css/ui.jqgrid.css') }}"/>
<link rel="stylesheet" href="{{ asset('bundles/hermes/acev12/css/uncompressed/jqgrid-informes.css') }}"/>
<script src="{{ asset('bundles/hermes/acev12/js/jqGrid/i18n/grid.locale-es.js') }}" type="text/javascript"></script>
<script src="{{ asset('bundles/hermes/acev12/js/jqGrid/jquery.jqGrid.min.js') }}" type="text/javascript"></script>
<script type="text/javascript">
    $('.zoom-pagos').css('zoom', '0.7');
</script>
<script>
    function tableToExcel(id, type) {
        $("#detallePagosCajeros").table2excel({
            name: "consolidado",
            sheetName: "consolidado",
            filename: "descarga",
            fileext: ".xlsx",
            exclude_img: false,
            exclude_links: false,
            exclude_inputs: false
        });
    }
</script>