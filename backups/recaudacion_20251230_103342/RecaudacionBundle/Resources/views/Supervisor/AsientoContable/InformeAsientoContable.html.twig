<style>
    body .modal {
        width: 98%;
        left: 1%;
        height: 90%;
        margin-right: auto;
        margin-left: 0%;
    }

    body .modal-body {
        padding: 1px;
        max-height: 92%;
        height: 92%;
    }

    body .modal.fade.in {
        top: 5%;
        bottom: 5%;
    }
</style>

<div class="table-header header-color-blue " style="text-align:left;">
    <span class="white"><b>ASIENTOS CONTABLES:</b></span>
</div>
<br/>
<div id="detallePagosCajeros">
    <table width="100%" border="0" cellspacing="0" cellpadding="0"
           class="table table-bordered table-condensed  grey zoom-pagos">
        <tr style=" background-color: #f5f5f5">
            <th> Cuenta</th>
            <th> Glosa</th>
            <th> Debe</th>
            <th> Haber</th>
            <th> Sub.Cuenta</th>
            <th> Tipo Documento</th>
            <th> Documento</th>
            <th> Fecha de Emisi√≥n</th>
            <th> Fecha de Vencimiento</th>
        </tr>
        <tbody>
        {% set cambio =  asientosContablesArray[0].id %}
        {% set haber = 0 %}
        {% set cuentaPadre = 0 %}
        {% set glosa = '' %}
        {% set numDocumento = '' %}
        {% set subCuenta = '' %}
        {% set fecha = '' %}
        {% set idCuentaPrevalece = '' %}
        {% for m in asientosContablesArray %}
            {% if m.id != cambio %}
                {% set cambio = m.id %}
                <tr>
                    {% if cuentasHaber is not empty %}
                        {% for ch in cuentasHaber %}
                            {% if idCuentaPrevalece != '' %}
                                {% if idCuentaPrevalece == ch.id %}
                                    <td>{{ ch.cuentaContable }}</td>
                                {% endif %}
                            {% else %}
                                {% if cuentaPadre == ch.id %}
                                    <td>{{ ch.cuentaContable }}</td>
                                {% else %}
                                    <td>-</td>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <td>-</td>
                    {% endif %}
                    <td>TRASPASO DE: {{ glosa|upper }}</td>
                    <td style=" text-align: right ">0</td>
                    <td style=" text-align: right ">{{ haber | number_format(0, '', '.') }}</td>
                    <td>{{ subCuenta|upper }}</td>
                    <td> ---- </td>
                    <td>{{ numDocumento }}</td>
                    <td>{{ fecha | hermes_date_format() }}</td>
                    <td>{{ fecha | hermes_date_format() }}</td>
                </tr>
                {% set idCuentaPrevalece = '' %}
                {% set haber = 0 %}
            {% endif %}
            {% set cuentaPadre = m.cuentaPadre %}
            {% set glosa = m.nombrePnatural ~ ' ' ~ m.apellidoPaterno|upper ~ ' ' ~ m.apellidoMaterno|upper %}
            {% set haber = haber + m.debe  %}
            {% set numDocumento = m.id %}
            {% set subCuenta = m.identificacionExtranjero %}
            {% set fecha = m.fechaPago %}
            {% if m.tipoForma == 3 or m.tipoForma == 5 or m.tipoForma == 11 %}
                {% set idCuentaPrevalece = m.cuentaPadre %}
            {% endif %}
            <tr>
                {% if m.cuentaContable is not null %}
                    <td>{{ m.cuentaContable }}</td>
                {% else %}
                    <td>-</td>
                {% endif %}
                <td>TRASPASO DE: {{ m.nombrePnatural|upper }} {{ m.apellidoPaterno|upper }} {{ m.apellidoMaterno|upper }}</td>
                <td style=" text-align: right ">{{ m.debe | number_format(0, '', '.') }}</td>
                <td style=" text-align: right ">0</td>
                <td>{{ m.identificacionExtranjero|upper }}</td>
                {% if m.ultimos4Numeros == null %}
                    <td>{% if m.tipoDocumento is not null %} {{ m.tipoDocumento|upper }} {% else %} ---- {% endif %}</td>
                    {% if m.numeroVoucher != null %}
                        <td>{{ m.numeroVoucher }}</td>
                    {% endif %}
                    {% if m.numeroDocumento != null %}
                        <td>{{ m.numeroDocumento }}</td>
                    {% endif %}
                    {% if m.numeroDocumento == null and m.numeroVoucher == null %}
                        <td>S/D</td>
                    {% endif %}
                {% else %}
                    {% if m.tarjetaTipo|upper == 'CR' %}
                        <td>TC</td>
                    {% else %}
                        <td>TD</td>
                    {% endif %}
                    <td>{{ m.ultimos4Numeros }}</td>
                {% endif %}
                <td>{{ m.fechaPago | hermes_date_format() }}</td>
                {% if m.fechaDocumento != null %}
                    <td>{{ m.fechaDocumento | hermes_date_format() }}</td>
                {% else %}
                    <td>{{ m.fechaPago | hermes_date_format() }}</td>
                {% endif %}
            </tr>
        {% endfor %}
        <tr>
            {% if cuentasHaber is not empty %}
                {% for ch in cuentasHaber %}
                    {% if idCuentaPrevalece != '' %}
                        {% if idCuentaPrevalece == ch.id %}
                            <td>{{ ch.cuentaContable }}</td>
                        {% endif %}
                    {% else %}
                        {% if cuentaPadre == ch.id %}
                            <td>{{ ch.cuentaContable }}</td>
                        {% else %}
                            <td>-</td>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% else %}
                <td>-</td>
            {% endif %}
            <td>TRASPASO DE: {{ glosa|upper }}</td>
            <td style=" text-align: right ">0</td>
            <td style=" text-align: right ">{{ haber | number_format(0, '', '.') }}</td>
            <td>{{ subCuenta|upper }}</td>
            <td> ---- </td>
            <td>{{ numDocumento }}</td>
            <td>{{ fecha | hermes_date_format() }}</td>
            <td>{{ fecha | hermes_date_format() }}</td>
        </tr>
        </tbody>
    </table>
    <br>
</div>
<link rel="stylesheet" href="{{ asset('bundles/hermes/acev12/css/ui.jqgrid.css') }}"/>
<link rel="stylesheet" href="{{ asset('bundles/hermes/acev12/css/uncompressed/jqgrid-informes.css') }}"/>
<script src="{{ asset('bundles/hermes/acev12/js/jqGrid/i18n/grid.locale-es.js') }}" type="text/javascript"></script>
<script src="{{ asset('bundles/hermes/acev12/js/jqGrid/jquery.jqGrid.min.js') }}" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function(){
        $('.zoom-pagos').css('zoom', '0.9');

        $('.btn-print').on('click', function (e) {
            e.preventDefault();
            $('#loading').show();
            window.location =  "{{ path('Caja_Supervisor_AsientoContable_Descargas', {'fechaIni':fechaIni|date('Y-m-d'), 'fechaFin':fechaFin|date('Y-m-d'), 'idSucursal':idSucursal, 'idUsuario':idUsuario}) }}"
            setTimeout( function() {
                $('#loading').hide();
            }, 3000);
        });
    });
</script>
