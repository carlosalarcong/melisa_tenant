{% extends 'base.html.twig' %}

{% block title %}{{ 'dashboard.title'|trans }} - {{ 'establishments.hospital'|trans }}{% endblock %}

{% block dashboard_indicator %}üè• {{ 'establishments.hospital'|trans }} ({{ 'settings.general'|trans|title }}){% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block bg-dark sidebar position-fixed">
            <div class="position-sticky pt-3">
                <div class="text-center mb-4">
                    <h5 class="text-white">üè• {{ 'establishments.hospital'|trans }}</h5>
                    <small class="text-muted">{{ subdomain }}.melisaupgrade.prod</small>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="/dashboard">
                            <i class="fas fa-tachometer-alt"></i> {{ 'nav.dashboard'|trans }}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/pacientes">
                            <i class="fas fa-users"></i> {{ 'nav.patients'|trans }}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/emergencias">
                            <i class="fas fa-ambulance"></i> {{ 'establishments.emergency_room'|trans }}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/quirofanos">
                            <i class="fas fa-procedures"></i> {{ 'establishments.operating_room'|trans }}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/laboratorio">
                            <i class="fas fa-vial"></i> {{ 'medical_records.laboratory'|trans|default('Laboratorio') }}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/farmacia">
                            <i class="fas fa-pills"></i> {{ 'medical_records.pharmacy'|trans|default('Farmacia') }}
                        </a>
                    </li>
                    
                    <!-- Separador -->
                    <li class="nav-item mt-3">
                        <hr class="sidebar-divider" style="border-color: #495057;">
                        <small class="text-muted px-3">{{ 'nav.administration'|trans|upper }}</small>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/mantenedores">
                            <i class="fas fa-cogs"></i> Mantenedores
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/configuracion">
                            <i class="fas fa-wrench"></i> Configuraci√≥n
                        </a>
                    </li>
                </ul>
                
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <!-- IDENTIFICADOR VISUAL: Template Hospital Personalizado -->
            <div class="alert alert-info border-start border-primary border-4 mb-3 mt-3" role="alert">
                <div class="d-flex align-items-center">
                    <i class="fas fa-hospital fa-2x text-primary me-3"></i>
                    <div>
                        <h5 class="alert-heading mb-1">üè• Dashboard Hospital Melisa</h5>
                        <p class="mb-0 small">Template personalizado para <strong>melisahospital</strong> - Funcionalidades m√©dicas avanzadas</p>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">{{ 'dashboard.title'|trans }} - {{ 'establishments.hospital'|trans }}</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-sm btn-danger">
                            <i class="fas fa-exclamation-triangle"></i> {{ 'establishments.emergency_room'|trans }}
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-download"></i> {{ 'nav.reports'|trans }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Cards -->
            <div class="row">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-danger shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                        {{ 'hospital.active_emergencies'|trans }}</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">3</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-ambulance fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        {{ 'hospital.inpatients'|trans }}</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">147</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-bed fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-success shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        {{ 'hospital.scheduled_surgeries'|trans }}</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">12</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-procedures fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-warning shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        {{ 'hospital.icu_occupancy'|trans }}</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">85%</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-heart-pulse fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards de Acceso R√°pido a Administraci√≥n -->
            <div class="row mb-4">
                <div class="col-xl-4 col-md-6 mb-4">
                    <div class="card border-left-info shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        MANTENEDORES</div>
                                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                                        <a href="/mantenedores" class="text-decoration-none">
                                            Gesti√≥n de Datos B√°sicos
                                        </a>
                                    </div>
                                    <small class="text-muted">{{ 'dashboard.countries_regions_etc'|trans }}</small>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-cogs fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-4 col-md-6 mb-4">
                    <div class="card border-left-secondary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                                        CONFIGURACI√ìN</div>
                                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                                        <a href="/configuracion" class="text-decoration-none">
                                            Ajustes del Sistema
                                        </a>
                                    </div>
                                    <small class="text-muted">{{ 'dashboard.users_permissions_etc'|trans }}</small>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-wrench fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-4 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        REPORTES</div>
                                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                                        <a href="/reportes" class="text-decoration-none">
                                            Informes y Estad√≠sticas
                                        </a>
                                    </div>
                                    <small class="text-muted">{{ 'dashboard.patients_emergencies_etc'|trans }}</small>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-chart-bar fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hospital specific content -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 bg-danger text-white">
                            <h6 class="m-0 font-weight-bold">üö® {{ 'hospital.emergency_center'|trans }}</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>{{ 'hospital.priority'|trans }}</th>
                                            <th>{{ 'hospital.patient'|trans }}</th>
                                            <th>{{ 'hospital.symptoms'|trans }}</th>
                                            <th>{{ 'hospital.time'|trans }}</th>
                                            <th>{{ 'hospital.status'|trans }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><span class="badge bg-danger">{{ 'hospital.critical'|trans }}</span></td>
                                            <td>{{ 'hospital.anonymous_patient'|trans }}</td>
                                            <td>{{ 'hospital.multiple_trauma'|trans }}</td>
                                            <td>5 min</td>
                                            <td><span class="badge bg-warning">{{ 'hospital.in_care'|trans }}</span></td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning">{{ 'hospital.urgent'|trans }}</span></td>
                                            <td>Carlos M√©ndez</td>
                                            <td>{{ 'hospital.chest_pain'|trans }}</td>
                                            <td>15 min</td>
                                            <td><span class="badge bg-info">{{ 'hospital.waiting'|trans }}</span></td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-success">{{ 'hospital.mild'|trans }}</span></td>
                                            <td>Ana Flores</td>
                                            <td>{{ 'hospital.high_fever'|trans }}</td>
                                            <td>30 min</td>
                                            <td><span class="badge bg-info">{{ 'hospital.waiting'|trans }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">{{ 'hospital.operating_rooms_status'|trans }}</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>{{ 'establishments.operating_room'|trans }} 1</span>
                                    <span class="badge bg-danger">{{ 'hospital.occupied'|trans }}</span>
                                </div>
                                <small class="text-muted">{{ 'hospital.cardiovascular_surgery'|trans }} - Dr. Ram√≠rez</small>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>{{ 'establishments.operating_room'|trans }} 2</span>
                                    <span class="badge bg-success">{{ 'hospital.available'|trans }}</span>
                                </div>
                                <small class="text-muted">{{ 'hospital.ready_to_use'|trans }}</small>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>{{ 'establishments.operating_room'|trans }} 3</span>
                                    <span class="badge bg-warning">{{ 'hospital.preparation'|trans }}</span>
                                </div>
                                <small class="text-muted">{{ 'hospital.scheduled_surgery'|trans }} 14:00</small>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>{{ 'establishments.operating_room'|trans }} 4</span>
                                    <span class="badge bg-danger">{{ 'hospital.occupied'|trans }}</span>
                                </div>
                                <small class="text-muted">{{ 'hospital.orthopedic_surgery'|trans }} - Dr. Silva</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üìö SECCI√ìN DE APRENDIZAJE STIMULUS -->
            <div class="row mt-4">
                <div class="col-lg-12">
                    <div class="card shadow mb-4 border-success">
                        <div class="card-header py-3 bg-success text-white">
                            <h6 class="m-0 font-weight-bold">üìö Aprendiendo Stimulus - Ejemplo de Paciente</h6>
                        </div>
                        <!-- üéØ CONTROLADOR STIMULUS ACTUALIZADO - NUEVA ESTRUCTURA -->
                        <div class="card-body" 
                             data-controller="internal--patient"
                             data-internal--patient-patient-id-value="12345"
                             data-internal--patient-is-editing-value="false"
                             data-internal--patient-validate-on-change-value="true">
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>üéÆ Controles y B√∫squeda</h5>
                                    <p class="text-muted">{{ 'dashboard.database_interaction'|trans }}:</p>
                                    
                                    <!-- üîç B√öSQUEDA DE PACIENTES -->
                                    <div class="mb-3">
                                        <label class="form-label">üîç Buscar Paciente:</label>
                                        <input type="text" 
                                               class="form-control" 
                                               placeholder="Nombre o RUT..."
                                               data-action="input->internal--patient#searchPatients">
                                    </div>
                                    
                                    <!-- üîò SELECCI√ìN R√ÅPIDA DE PACIENTES -->
                                    <div class="mb-3">
                                        <label class="form-label">üë• Pacientes de Ejemplo:</label><br>
                                        <button class="btn btn-outline-primary btn-sm me-1" 
                                                data-action="click->internal--patient#changePatient"
                                                data-patient-id="12345">
                                            Juan P√©rez
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm me-1" 
                                                data-action="click->internal--patient#changePatient"
                                                data-patient-id="67890">
                                            Ana Rodr√≠guez
                                        </button>
                                    </div>
                                    
                                    <!-- üîò ACTIONS PRINCIPALES -->
                                    <button class="btn btn-primary me-2" 
                                            data-action="click->internal--patient#showInfo">
                                        üìã Cargar desde BD
                                    </button>
                                    
                                    <button class="btn btn-secondary" 
                                            data-action="click->internal--patient#clearInfo">
                                        üßπ Limpiar
                                    </button>
                                    
                                    <!-- üîÑ INDICADORES DE ESTADO -->
                                    <div data-internal--patient-target="loading" 
                                         style="display: none;" 
                                         class="mt-3">
                                        <div class="alert alert-info">
                                            <i class="fas fa-spinner fa-spin"></i> Cargando datos...
                                        </div>
                                    </div>
                                    
                                    <div data-internal--patient-target="error" 
                                         style="display: none;" 
                                         class="mt-3 alert alert-danger">
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h5>üìä Informaci√≥n del Paciente</h5>
                                    
                                    <!-- üéØ TARGETS MEJORADOS - Con m√°s datos de la BD -->
                                    <div data-internal--patient-target="info" style="display: none;" class="mt-3">
                                        <div class="card border-info">
                                            <div class="card-header bg-info text-white">
                                                <strong>üë§ <span data-internal--patient-target="name"></span></strong>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <strong>üìä Estado:</strong><br>
                                                        <span data-internal--patient-target="status" class="badge bg-success"></span>
                                                    </div>
                                                    <div class="col-6">
                                                        <strong>üéÇ Edad:</strong><br>
                                                        <span data-internal--patient-target="age"></span>
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-6">
                                                        <strong>üìû Tel√©fono:</strong><br>
                                                        <span data-internal--patient-target="phone" class="text-muted"></span>
                                                    </div>
                                                    <div class="col-6">
                                                        <strong>ü©∏ Tipo Sangu√≠neo:</strong><br>
                                                        <span data-internal--patient-target="bloodType" class="badge bg-danger"></span>
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <strong>üè† Direcci√≥n:</strong><br>
                                                        <span data-internal--patient-target="address" class="text-muted"></span>
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <strong>‚ö†Ô∏è Alergias:</strong><br>
                                                        <span data-internal--patient-target="allergies" class="text-warning"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <hr class="my-4">
                            
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="text-primary">üîç ¬øC√≥mo funciona la conexi√≥n con la Base de Datos?</h6>
                                    <div class="alert alert-light">
                                        <h6 class="text-success">üì° Flujo de Datos:</h6>
                                        <ol class="mb-2">
                                            <li><strong>{{ 'dashboard.frontend_stimulus'|trans }}</strong> ‚Üí hace fetch() a la API</li>
                                            <li><strong>{{ 'dashboard.api_controller'|trans }}</strong> ‚Üí consulta la base de datos</li>
                                            <li><strong>{{ 'dashboard.json_response'|trans }}</strong> ‚Üí regresa al frontend</li>
                                            <li><strong>{{ 'dashboard.ui_update'|trans }}</strong> ‚Üí Stimulus actualiza el DOM</li>
                                        </ol>
                                        
                                        <h6 class="text-info mt-3">üõ†Ô∏è Implementaci√≥n:</h6>
                                        <ul class="list-unstyled mb-0">
                                            <li><code>data-patient-api-url-value="/api/patients"</code> ‚Üí URL de la API</li>
                                            <li><code>fetch(`/api/patients/${id}`)</code> ‚Üí Llamada AJAX</li>
                                            <li><code>PatientApiController::getPatient()</code> ‚Üí Endpoint Symfony</li>
                                            <li><code>TenantContext</code> ‚Üí Base de datos espec√≠fica del tenant</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

{% endblock %}