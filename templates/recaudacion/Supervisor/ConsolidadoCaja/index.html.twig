{% extends 'RecaudacionBundle:Supervisor:sublayout.html.twig' %}

{% block contenedorMantenedor -%}
	<form id="new_form" class="form-horizontal" action="{{ path('Caja_Supervisor_ConsolidadoCaja_Informe') }}" method="post">
		<div class="table-header">
			Búsqueda de Cajas Por Fecha
			<div id="div-volver" class="btn-group pull-right">
				<a id="volverListado" class="btn btn-mini" href="{{ path('Caja_Supervisor') }}">
					<i class="icon-arrow-left"></i> Volver
				</a>
			</div>
		</div>

		<br>

		<table align='center' width="40%">
			<tr>
				<th align="left" width="70">Fecha</th>
				<td style=" padding: 10px 0 0 0">{{ form_widget(form.fecha, { 'attr': {'class': 'span3'} }) }}</td>
			</tr>
			<tr>
				<th align="left" width="70">Sucursal</th>
				<td style=" padding: 10px 0 0 0">{{ form_widget(form.Sucursal, { 'attr': {'class': 'span3'} }) }}</td>
			</tr>
			<tr>
				<td colspan="2"><br><div style="width:350px" align="center">{{form_rest(form)}}</div></td>
			</tr>
		</table>

		{#Pie de página#}
		<div class="table-footer">
			<div class="btn-group pull-right">
				<a class="btn btn-mini" href="{{ path('Caja_Supervisor') }}">
					<i class="icon-arrow-left"></i> Volver
				</a>
				<a class="btn btn-mini btn-info btn1" href="{{ path('Caja_Supervisor_ConsolidadoCaja_Informer') }}">
					<i class="icon-check-sign"></i> Aceptar
				</a>
			</div>
		</div>

	</form>
{% endblock %}
{% block scripts -%}
	{#Para generar calendario en el formato de la macro#}
	{{ macroDependencias.datetime() }}
	<script type="text/javascript">
	$(document).on('ready', function(){
		$('.menuSUpervisor').removeClass('active');
		$('#ConsolidadoCaja').addClass('active');
		{#Ocultamos el botón de aceptar mientras no se hayan seleccionado la fecha y la sucursal#}
		$('.btn1').hide();
		{#Detecta algún cambio en la fecha#}
		$("#consolidado_caja_type_fecha").change(function(){
			ValidaEntrada();
		});
		{#Detecta algún cambio en el combobox sucursal#}
		$("#consolidado_caja_type_Sucursal").change(function(){
			ValidaEntrada();
		});

		function ValidaEntrada(){
			if(($("#consolidado_caja_type_fecha").val() != "") && ($("#consolidado_caja_type_Sucursal").val() != null)){
				enviaDatos();
				muestraBoton()
			}
		}

		{#Función que muestra el botón aceptar una vez que el usuario haya seleccionado la fecha y la sucursal#}
		function muestraBoton(){
			$('.btn1').show();
		}
		function enviaDatos(){
			var fecha = $("#consolidado_caja_type_fecha").val();
			var sucursal = $("#consolidado_caja_type_Sucursal").val();
			{#Enviamos la fecha ingresada por el usuario mediante ajax#}
			var datos    = {
				fechaIngresada: fecha,
				sucursal: sucursal
			};

			$.ajax({
				type: "get",
				url: "{{ path('Caja_Supervisor_ConsolidadoCaja_Informe') }}",
				data: datos,
				success: function(data){
				}
			}
			)
		}
		{#Script que obtiene desde el controlador el objeto sucursal y tipoPrevision que muestre el valor por defecto si es uno solo#}
		setTimeout(function(){
			{% if oSucursal != 'false' %}
			$("#consolidado_caja_type_Sucursal").val('{{ oSucursal }}');
			{% endif %}
			validaCombobox();
		}, 500);
	});
	</script>
{% endblock %}